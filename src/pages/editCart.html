<body>
    <h2 class="center" id="header"><img src="/assets/icons/pen.png">EDIT CART</h2>
    <p class="center" id="description">Fill in the details below to edit cart.</p>
    <form id="editCartForm">
        <div class="formGroup">
            <label for="number">Number</label>
            <input type="number" name="number" placeholder="Enter cart number" required>
        </div>
        <div class="formGroup">
            <label for="name">Name</label>
            <input type="text" name="name" placeholder="Enter cart name" required>
        </div>
        <div class="formGroup">
            <label for="responsible">Responsible</label>
            <input type="text" name="responsible" placeholder="Enter responsible">
        </div>
        <div class="formGroup">
            <label for="location">Location</label>
            <select name="location" required>
                <option value="">Select location</option>
            </select>
        </div>
        <div class="formGroup">
            <label for="location"></label>
            <a class="normal rounded small full" onclick="save();" data-page="editLocations"><img
                    src="/assets/icons/settings.png">Manage locations</a>
        </div>
    </form>
    <hr>
    <a type="submit" id="saveButton" class="normal rounded full medium" onclick="save();" data-page="home"><img
            src="/assets/icons/save.png">Save
        changes</a>
    <a class="normal rounded full small" onclick="cancel();"><img src="/assets/icons/close.png">Cancel</a>
</body>
<script>
    function initForm() {
        if (session.newCart) {
            document.getElementById('header').innerHTML = "<img src='/assets/icons/pen.png'>ADD CART";
            document.getElementById('description').innerText = "Fill in the details below to add a new cart.";
            document.getElementById('saveButton').innerHTML = "<img src='/assets/icons/add.png'>Add cart";
        }

        const form = document.getElementById('editCartForm');
        const cartIndex = session.currentCartIndex;
        const cart = data.carts[cartIndex];

        for (const locationID in data.locations) {
            const location = data.locations[locationID];
            const option = document.createElement('option');
            option.value = locationID;
            option.textContent = location.name;
            form.location.appendChild(option);
        }

        form.number.value = cart.number;
        form.name.value = cart.name;
        form.location.value = cart.locationID;
        form.responsible.value = cart.responsible;
    }

    initForm();

    function save() {
        const form = document.getElementById('editCartForm');
        const cartIndex = session.currentCartIndex;
        const cart = data.carts[cartIndex];

        if (!parseInt(form.number.value)) {
            form.number.value = 0;
        }

        cart.number = parseInt(form.number.value);
        cart.name = form.name.value;
        cart.locationID = form.location.value;
        cart.responsible = form.responsible.value;

        saveData();
        session.newCart = false;
    }

    function cancel() {
        if (session.newCart) {
            delete data.carts[session.currentCartIndex];
        }

        session.newCart = false;
        saveData();
        navigateBack();
    }
</script>